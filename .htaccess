# Configuración para Next.js estático + Backend API
# Maneja redirección de API al backend y archivos estáticos del frontend

# Habilitar motor de reescritura
RewriteEngine On

# Redirigir todas las peticiones de la API al backend
RewriteCond %{REQUEST_URI} ^/api/
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^api/(.*)$ backend/public/index.php [L,QSA]

# No reescribir archivos/carpetas reales (incluye /_next/ y assets)
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Fallback SPA - redirigir todo a index.html
RewriteRule ^ index.html [L]

# Configuración de índices
DirectoryIndex index.html index.php
Options -Indexes

# Control de caché
<IfModule mod_headers.c>
  # No cachear HTML (evita pantallas blancas por mismatch de chunks)
  <FilesMatch "\.(html)$">
    Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
    Header set Pragma "no-cache"
    Header set Expires "0"
  </FilesMatch>

  # Cache largo para assets de Next.js
  <FilesMatch "^.*\.(js|css|woff|woff2|png|jpg|jpeg|svg|gif|ico|webp|avif)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>
</IfModule>